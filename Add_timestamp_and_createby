CREATE TABLE transaction_table
  WITH (
    KAFKA_TOPIC = 'transaction_table_topic',
    VALUE_FORMAT = 'JSON'
  ) AS
  SELECT 
    CUSTOMER_ID, 
    LATEST_BY_OFFSET(MONTH) AS MONTH,
    LATEST_BY_OFFSET(CATEGORY) AS CATEGORY,
    LATEST_BY_OFFSET(PAYMENT_TYPE) AS PAYMENT_TYPE,
    LATEST_BY_OFFSET(SPEND) AS SPEND,
    LATEST_BY_OFFSET(TRANSACTION_ID) AS TRANSACTION_ID,
    TIMESTAMPTOSTRING(LATEST_BY_OFFSET(ROWTIME), 'yyyy-MM-dd HH:mm:ss', 'UTC') AS CREATE_DATE, -- Correctly uses LATEST_BY_OFFSET
    'vamshi' AS CREATED_BY       
  FROM TRANSACTION_STREAM
  GROUP BY CUSTOMER_ID;

